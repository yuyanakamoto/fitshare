# FitShare フォロー機能 要件定義書

## 1. 概要
FitShareにInstagramライクな一方向フォロー機能を追加し、プライベートなフィットネスコミュニティを構築する。

## 2. 基本仕様

### 2.1 フォロー関係
- **一方向フォロー**（Twitterスタイル）
- ユーザーAがユーザーBをフォロー → 承認不要で即座にフォロー成立
- ユーザーBは自動的にフォローバックされない

### 2.2 投稿の公開範囲
- **すべての投稿をフォロワー限定**に変更
- 既存投稿も含めてフォロワーのみに表示
- パブリック投稿機能は廃止

### 2.3 フィード表示
- **ホームフィード**：フォローしているユーザーの投稿のみ表示
- パブリックフィードは廃止（切り替え機能なし）

## 3. 機能一覧

### 3.1 フォロー機能
- [ ] ユーザーをフォローする
- [ ] ユーザーのフォローを解除する
- [ ] フォロー状態の確認

### 3.2 検索機能
- [ ] ユーザー名による検索
- [ ] 検索結果からのフォロー

### 3.3 表示機能
- [ ] フォロー数の表示
- [ ] フォロワー数の表示
- [ ] フォロー中ユーザーリスト
- [ ] フォロワーユーザーリスト

### 3.4 権限制御
- [ ] 投稿表示権限（フォロワーのみ）
- [ ] プロフィール閲覧権限

## 4. UI/UX設計

### 4.1 プロフィール画面
```
[アバター画像] [ユーザー名]
                [フォロー/フォロー中ボタン] ← アバター近くに配置

総投稿数: 123件 | フォロー: 45 | フォロワー: 67 ← 横並びで表示
```

### 4.2 検索ページ
- 専用の検索ページを新規作成
- ユーザー名入力フィールド
- 検索結果リスト（フォローボタン付き）

### 4.3 フォロー関係ページ
- フォロー中リスト：別ページまたはモーダル
- フォロワーリスト：別ページまたはモーダル

## 5. データベース設計

### 5.1 新規テーブル: follows
```sql
CREATE TABLE follows (
  id SERIAL PRIMARY KEY,
  follower_id INTEGER REFERENCES users(id),
  following_id INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(follower_id, following_id)
);
```

### 5.2 インデックス
```sql
CREATE INDEX idx_follows_follower ON follows(follower_id);
CREATE INDEX idx_follows_following ON follows(following_id);
```

## 6. API設計

### 6.1 フォロー関連API
```javascript
POST   /api/follow/:userId          // ユーザーをフォロー
DELETE /api/follow/:userId          // フォロー解除
GET    /api/user/:userId/followers  // フォロワー一覧
GET    /api/user/:userId/following  // フォロー中一覧
GET    /api/user/:userId/follow-status // フォロー状態確認
```

### 6.2 検索API
```javascript
GET    /api/search/users?q=username // ユーザー名検索
```

### 6.3 フィードAPI
```javascript
GET    /api/posts/following        // フォロー中の投稿のみ
```

## 7. 既存システムへの影響

### 7.1 投稿表示ロジック
- `PostList`コンポーネント：フォロー中投稿のみ取得するよう修正
- 投稿取得API：フォロー関係をJOINして権限チェック

### 7.2 プロフィール画面
- `ProfilePage`コンポーネント：フォロー関係UI追加
- 他ユーザープロフィール：フォロー状態により表示制御

### 7.3 既存データの移行
- **全既存ユーザーを相互フォロー状態**にするマイグレーション実行
- 既存投稿は自動的にフォロワー限定となる

## 8. 実装優先順位

### Phase 1: 基本フォロー機能
1. データベース設計・構築
2. フォロー/フォロー解除API
3. フォロー状態表示

### Phase 2: 権限制御
1. 投稿表示権限の実装
2. フィード機能の修正

### Phase 3: 検索・UI拡張
1. ユーザー検索機能
2. フォロー関係リスト表示

## 9. 注意事項
- 通知機能は今回実装しない
- パフォーマンスを考慮し、フォロー数が多い場合のページネーション検討
- 既存ユーザーの相互フォロー設定により、機能追加後も違和感なく利用可能